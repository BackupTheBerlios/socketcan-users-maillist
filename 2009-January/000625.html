<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Socketcan-users] [Xenomai-help] rtcanconfig rtcansend rtcanrecv
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/socketcan-users/2009-January/index.html" >
   <LINK REL="made" HREF="mailto:socketcan-users%40lists.berlios.de?Subject=Re%3A%20%5BSocketcan-users%5D%20%5BXenomai-help%5D%20rtcanconfig%20rtcansend%20rtcanrecv&In-Reply-To=%3CCF7FB0793253794F9F45991443E5FE2004DF784B3D%40us194mx002.tycoelectronics.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000624.html">
   <LINK REL="Next"  HREF="000620.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Socketcan-users] [Xenomai-help] rtcanconfig rtcansend rtcanrecv</H1>
    <B>Charlton, John</B> 
    <A HREF="mailto:socketcan-users%40lists.berlios.de?Subject=Re%3A%20%5BSocketcan-users%5D%20%5BXenomai-help%5D%20rtcanconfig%20rtcansend%20rtcanrecv&In-Reply-To=%3CCF7FB0793253794F9F45991443E5FE2004DF784B3D%40us194mx002.tycoelectronics.net%3E"
       TITLE="[Socketcan-users] [Xenomai-help] rtcanconfig rtcansend rtcanrecv">john.charlton at tycoelectronics.com
       </A><BR>
    <I>Wed Jan 14 21:50:00 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000624.html">[Socketcan-users] [Xenomai-help] rtcanconfig rtcansend rtcanrecv
</A></li>
        <LI>Next message: <A HREF="000620.html">[Socketcan-users] [Xenomai-help] rtcanconfig rtcansend rtcanrecv
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#625">[ date ]</a>
              <a href="thread.html#625">[ thread ]</a>
              <a href="subject.html#625">[ subject ]</a>
              <a href="author.html#625">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Wolfgang,

I am attaching the latest rtcan_tscan1.c module which is now working. Thank you for the help and the tip on the hardware configuration.  The problem turned out to be a bios setting in the Nano-7240 embedded PC board.  All interrupts are set by default to be PCI/PnP and the TS-CAN1 PC-104 card requires ISA/EISA configuration.  I set irq 5 to ISA/EISA and now it works as advertised with one interrupt.  I am still not able to get irq 6 or 7 to generate an interrupt from the second TS-CAN1 so I am going to test with separate CPU boards.

One limitation of the driver is that it requires the first TS-CAN1 (rtcan0) to be at the JP1,JP2 OFF,OFF jumper setting for address 0x150, the second to be at JP1,JP2 ON,OFF for address 0x158 (rtcan1) etc.  The io addresses for the sja1000 are io=0x100,0x120,0x180,0x1A0 which are the addresses specified when the driver module is loaded.

--John

-----Original Message-----
From: Wolfgang Grandegger [mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/socketcan-users">wg at grandegger.com</A>] 
Sent: Tuesday, January 13, 2009 10:05 AM
To: Charlton, John
Cc: <A HREF="https://lists.berlios.de/mailman/listinfo/socketcan-users">xenomai-help at gna.org</A>; <A HREF="https://lists.berlios.de/mailman/listinfo/socketcan-users">socketcan-users at lists.berlios.de</A>
Subject: Re: [Socketcan-users] [Xenomai-help] rtcanconfig rtcansend rtcanrecv

Charlton, John wrote:
&gt;<i> Wolfgang,
</I>&gt;<i> 
</I>&gt;<i> You are right.  I am just learning the sja1000 registers and modes and I was looking at the 'BasicCAN' register configuration and the sja1000 can driver is using the 'PeliCAN' mode.  So it does look like everything is configured correctly and it also looks like the data are tranferred from rtcan1 to rtcan0 registers except that the interrupts do not occur to notify the socket that the data is sent and received.  There does not appear to be any error messages but only debug messages in the dmesg output below (all of those Wrote/Read messages are generated by the rtcan_tscan1.c printk which I am removing to reduce the spew):
</I>
OK.

&gt;<i> - What do your read at offset 0x6 (JMP)?
</I>&gt;<i> For idx 0: 0x30, 1: 0x22
</I>
Looks good for the IRQ selection, but I can't tell what the bit 0x02 is good for.

This is to select the second TS-CAN1 base address at 0x158.

&gt;<i> - What does /proc/interrupts return?
</I>&gt;<i> cat /proc/interrupts
</I>&gt;<i>            CPU0       
</I>&gt;<i>   0:      12314    XT-PIC-XT        timer
</I>&gt;<i>   1:        146    XT-PIC-XT        i8042
</I>&gt;<i>   2:          0    XT-PIC-XT        cascade
</I>&gt;<i>   6:          0    XT-PIC-XT        uhci_hcd:usb1, uhci_hcd:usb2
</I>&gt;<i>  12:         13    XT-PIC-XT        eth0
</I>&gt;<i>  14:          0    XT-PIC-XT        ide0
</I>&gt;<i>  15:       2151    XT-PIC-XT        ide1
</I>&gt;<i> NMI:          0   Non-maskable interrupts
</I>&gt;<i> TRM:          0   Thermal event interrupts
</I>&gt;<i> ERR:          0
</I>
I just wanted to check if IRQ 3 and 5 is already used by Linux. You also can set the Xenomai IRQ flags in your driver to

  chip-&gt;irq_flags = 0;

because IRQ sharing is not required.

Maybe there are x86-related problems with the IRQs. I'm not really an expert, but sometimes there is trouble due to improper BIOS settings, interrupt routing, etc.

Wolfgang.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rtcan_tscan1.tgz
Type: application/x-compressed
Size: 2347 bytes
Desc: rtcan_tscan1.tgz
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/socketcan-users/attachments/20090114/cde5fe4e/attachment.bin">https://lists.berlios.de/pipermail/socketcan-users/attachments/20090114/cde5fe4e/attachment.bin</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000624.html">[Socketcan-users] [Xenomai-help] rtcanconfig rtcansend rtcanrecv
</A></li>
	<LI>Next message: <A HREF="000620.html">[Socketcan-users] [Xenomai-help] rtcanconfig rtcansend rtcanrecv
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#625">[ date ]</a>
              <a href="thread.html#625">[ thread ]</a>
              <a href="subject.html#625">[ subject ]</a>
              <a href="author.html#625">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/socketcan-users">More information about the Socketcan-users
mailing list</a><br>
</body></html>
