<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Socketcan-users] flexcan: Re:  Help with CAN_RAW_LOOPBACK
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/socketcan-users/2011-July/index.html" >
   <LINK REL="made" HREF="mailto:socketcan-users%40lists.berlios.de?Subject=Re%3A%20%5BSocketcan-users%5D%20flexcan%3A%20Re%3A%20%20Help%20with%20CAN_RAW_LOOPBACK&In-Reply-To=%3C4E25F245.1090305%40hartkopp.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001962.html">
   <LINK REL="Next"  HREF="001969.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Socketcan-users] flexcan: Re:  Help with CAN_RAW_LOOPBACK</H1>
    <B>Oliver Hartkopp</B> 
    <A HREF="mailto:socketcan-users%40lists.berlios.de?Subject=Re%3A%20%5BSocketcan-users%5D%20flexcan%3A%20Re%3A%20%20Help%20with%20CAN_RAW_LOOPBACK&In-Reply-To=%3C4E25F245.1090305%40hartkopp.net%3E"
       TITLE="[Socketcan-users] flexcan: Re:  Help with CAN_RAW_LOOPBACK">socketcan at hartkopp.net
       </A><BR>
    <I>Tue Jul 19 23:08:21 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="001962.html">[Socketcan-users] flexcan: Re:  Help with CAN_RAW_LOOPBACK
</A></li>
        <LI>Next message: <A HREF="001969.html">[Socketcan-users] flexcan: Re:  Help with CAN_RAW_LOOPBACK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1966">[ date ]</a>
              <a href="thread.html#1966">[ thread ]</a>
              <a href="subject.html#1966">[ subject ]</a>
              <a href="author.html#1966">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 19.07.2011 21:50, Wolfgang Grandegger wrote:

&gt;&gt;&gt;&gt;<i> Safe to assume that the flexcan driver doesn't support loopback as described
</I>&gt;&gt;&gt;&gt;<i> then?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://lxr.linux.no/#linux+v2.6.39/Documentation/networking/can.txt#L580">http://lxr.linux.no/#linux+v2.6.39/Documentation/networking/can.txt#L580</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Yes. Sigh.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> So this can be temporarily fixed by removing the line which sets IFF_ECHO ...
</I>&gt;&gt;&gt;<i> but of course should be fixed by implementing the can_echo_skb stuff.
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>  dev-&gt;flags |= IFF_ECHO; /* we support local echo in hardware */
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> IIRC, loopback is really done in hardware and the driver is working
</I>&gt;&gt;<i> properly on ARM processors.
</I>&gt;<i> 
</I>&gt;<i> See:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.berlios.de/pipermail/socketcan-core/2010-June/004432.html">https://lists.berlios.de/pipermail/socketcan-core/2010-June/004432.html</A>
</I>
Yes, but i'm pretty sure Marc mixed up the hardware loopback of the FlexCAN
controller with the IFF_ECHO requirement. The FlexCAN spec says:

&quot;Loopback mode &#8212; The module enters this mode when the LPB bit in the control
register is set to 1. In this mode, FlexCAN performs an internal loopback that
can be used for self test operation. The bit stream output of the transmitter
is internally fed back to the receiver input. The Rx CAN input
 signal is ignored and the Tx CAN output goes to the recessive state (logic
&#8216;1&#8217;). FlexCAN behaves as it normally does when transmitting and treats its own
transmitted message as a message received from a remote node. In this mode,
FlexCAN ignores the bit sent during the ACK slot in the CAN frame acknowledge
field to ensure proper reception of its own message. Both transmit and receive
interrupts are generated.&quot;

This means the &quot;Rx CAN input signal is ignored&quot; =&gt; only self test.

Regards,
Oliver

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001962.html">[Socketcan-users] flexcan: Re:  Help with CAN_RAW_LOOPBACK
</A></li>
	<LI>Next message: <A HREF="001969.html">[Socketcan-users] flexcan: Re:  Help with CAN_RAW_LOOPBACK
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1966">[ date ]</a>
              <a href="thread.html#1966">[ thread ]</a>
              <a href="subject.html#1966">[ subject ]</a>
              <a href="author.html#1966">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/socketcan-users">More information about the Socketcan-users
mailing list</a><br>
</body></html>
