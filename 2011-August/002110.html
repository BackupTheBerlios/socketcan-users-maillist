<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Socketcan-users] Performance issues with MPC5200B and socketcan
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/socketcan-users/2011-August/index.html" >
   <LINK REL="made" HREF="mailto:socketcan-users%40lists.berlios.de?Subject=Re%3A%20%5BSocketcan-users%5D%20Performance%20issues%20with%20MPC5200B%20and%20socketcan&In-Reply-To=%3C4E5B5950.7060006%40grandegger.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002109.html">
   <LINK REL="Next"  HREF="002095.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Socketcan-users] Performance issues with MPC5200B and socketcan</H1>
    <B>Wolfgang Grandegger</B> 
    <A HREF="mailto:socketcan-users%40lists.berlios.de?Subject=Re%3A%20%5BSocketcan-users%5D%20Performance%20issues%20with%20MPC5200B%20and%20socketcan&In-Reply-To=%3C4E5B5950.7060006%40grandegger.com%3E"
       TITLE="[Socketcan-users] Performance issues with MPC5200B and socketcan">wg at grandegger.com
       </A><BR>
    <I>Mon Aug 29 11:18:08 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002109.html">[Socketcan-users] Performance issues with MPC5200B and socketcan
</A></li>
        <LI>Next message: <A HREF="002095.html">[Socketcan-users] Need help starting socketCAN
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2110">[ date ]</a>
              <a href="thread.html#2110">[ thread ]</a>
              <a href="subject.html#2110">[ subject ]</a>
              <a href="author.html#2110">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

just start reading this thread...

On 08/17/2011 10:38 AM, &quot;M&#252;ller, Ren&#233;&quot; wrote:
&gt;<i> Hi all,
</I>&gt;<i> 
</I>&gt;<i> I have an performance issue with socketcan and an MPC5200B. My setup looks like this:
</I>&gt;<i>  - MPC5200B board (TQM5200)
</I>&gt;<i>  - custom base board with two PCA82C251, one for each can controller
</I>&gt;<i>  - linux-2.6.27.18-denx, I use the mpc52xx driver
</I>&gt;<i>  - booted with uboot and kernel from flash
</I>&gt;<i>  - mount root filesystem via NFS
</I>&gt;<i>  - can0 with 1Mbit/s
</I>&gt;<i>  - candump -l can0 to tmpfs
</I>&gt;<i> 
</I>&gt;<i> Now I play with the busload on can0 (generated by CANalyzer and three CANcaseXL). This leads to the following results:
</I>&gt;<i>  - 0% to 71% busload -&gt; no missing frames
</I>&gt;<i>  - 74% busload -&gt; 5% missing frames
</I>&gt;<i>  - 77% busload -&gt; 10% missing frames
</I>&gt;<i>  - 90% busload -&gt; 45% missing frames
</I>
What does &quot;cat /proc/interrupts; sleep 10; cat /proc/interrupts&quot; report
at 90&amp; bus load.

&gt;<i> The missing frames are measured by comparison of the candump log file against the CANalyzer log file. The indicated busload is measured by CANalyzer. The cause seems to be very simple: the cpu load is too high (or the cpu is too slow). When the busload is under 71%, the cpu load is under 100%. When the busload goes higher than 71%, the cpu load is 100%. This seems to be the cause for the missing frames.
</I>&gt;<i> 
</I>&gt;<i> Has anyone else ever seen such an performance issue? Does someone use the MPC5200B in high busload environments? Maybe I configured something wrong in my linux.
</I>
CAN can generate a very high interrupt and packet load, especially at 1
MB/s and the tasks handling the interrupt and packets in kernel and user
space may not be able to process them fast enough. Packet losses in
hardware and software are expected to happen at high bus load,
especially on load-end processors.

&gt;<i> What about lincan? It has an character device approach with very little overhead. Is there an chance, that this will solve my problem?
</I>
Well, the overhead is just a little better but the main issues are due
the isr and task latencies. Every measure reducing that latencies will
usually help:

- increase the priority of the user-space task
- increase the priority of the net soft irq thread
- use CONFIG_PREEMPT
- or even use CONFIG_PREEMPT_RT and prioritize the hard and soft-irq
  threads properly.

Also bigger buffers may help to some extend.

Wolfgang.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002109.html">[Socketcan-users] Performance issues with MPC5200B and socketcan
</A></li>
	<LI>Next message: <A HREF="002095.html">[Socketcan-users] Need help starting socketCAN
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2110">[ date ]</a>
              <a href="thread.html#2110">[ thread ]</a>
              <a href="subject.html#2110">[ subject ]</a>
              <a href="author.html#2110">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/socketcan-users">More information about the Socketcan-users
mailing list</a><br>
</body></html>
