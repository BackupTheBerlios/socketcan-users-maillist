<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Socketcan-users] Performance issues with MPC5200B and socketcan
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/socketcan-users/2011-August/index.html" >
   <LINK REL="made" HREF="mailto:socketcan-users%40lists.berlios.de?Subject=Re%3A%20%5BSocketcan-users%5D%20Performance%20issues%20with%20MPC5200B%20and%20socketcan&In-Reply-To=%3C4E4B8D3A.2010303%40volkswagen.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002089.html">
   <LINK REL="Next"  HREF="002093.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Socketcan-users] Performance issues with MPC5200B and socketcan</H1>
    <B>Oliver Hartkopp</B> 
    <A HREF="mailto:socketcan-users%40lists.berlios.de?Subject=Re%3A%20%5BSocketcan-users%5D%20Performance%20issues%20with%20MPC5200B%20and%20socketcan&In-Reply-To=%3C4E4B8D3A.2010303%40volkswagen.de%3E"
       TITLE="[Socketcan-users] Performance issues with MPC5200B and socketcan">oliver.hartkopp at volkswagen.de
       </A><BR>
    <I>Wed Aug 17 11:43:22 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002089.html">[Socketcan-users] Performance issues with MPC5200B and socketcan
</A></li>
        <LI>Next message: <A HREF="002093.html">[Socketcan-users] Performance issues with MPC5200B and socketcan
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2090">[ date ]</a>
              <a href="thread.html#2090">[ thread ]</a>
              <a href="subject.html#2090">[ subject ]</a>
              <a href="author.html#2090">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Am 17.08.2011 10:38, schrieb &quot;M&#252;ller, Ren&#233;&quot;:
&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> I have an performance issue with socketcan and an MPC5200B. My setup looks like this:
</I>&gt;<i>   - MPC5200B board (TQM5200)
</I>&gt;<i>   - custom base board with two PCA82C251, one for each can controller
</I>&gt;<i>   - linux-2.6.27.18-denx, I use the mpc52xx driver
</I>&gt;<i>   - booted with uboot and kernel from flash
</I>&gt;<i>   - mount root filesystem via NFS
</I>&gt;<i>   - can0 with 1Mbit/s
</I>&gt;<i>   - candump -l can0 to tmpfs
</I>
Hi Ren&#233;,

can you check if the frames are dropped on socket-level? I assume, that 
the candump is not able to dump the stuff into tmpfs at full speed.

See details at:

<A HREF="http://www.mail-archive.com/socketcan-users@lists.berlios.de/msg00170.html">http://www.mail-archive.com/socketcan-users@lists.berlios.de/msg00170.html</A>

As this functionality is only working on a 2.6.33+, i created a patch 
for our MPC5200 based system (which has a 2.6.28.10), that upgrades the 
CAN network and drivers to a recent functionality (including dropcount, 
isotp, cangw and a recent mpc52xx driver).

I can send the (huge) patches to you, if you're interested.

Regards,
Oliver

&gt;<i>
</I>&gt;<i> Now I play with the busload on can0 (generated by CANalyzer and three CANcaseXL). This leads to the following results:
</I>&gt;<i>   - 0% to 71% busload -&gt;  no missing frames
</I>&gt;<i>   - 74% busload -&gt;  5% missing frames
</I>&gt;<i>   - 77% busload -&gt;  10% missing frames
</I>&gt;<i>   - 90% busload -&gt;  45% missing frames
</I>&gt;<i>
</I>&gt;<i> The missing frames are measured by comparison of the candump log file against the CANalyzer log file. The indicated busload is measured by CANalyzer. The cause seems to be very simple: the cpu load is too high (or the cpu is too slow). When the busload is under 71%, the cpu load is under 100%. When the busload goes higher than 71%, the cpu load is 100%. This seems to be the cause for the missing frames.
</I>&gt;<i>
</I>&gt;<i> Has anyone else ever seen such an performance issue? Does someone use the MPC5200B in high busload environments? Maybe I configured something wrong in my linux.
</I>&gt;<i>
</I>&gt;<i> What about lincan? It has an character device approach with very little overhead. Is there an chance, that this will solve my problem?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Best regards,
</I>&gt;<i> Ren&#233;
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Socketcan-users mailing list
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/socketcan-users">Socketcan-users at lists.berlios.de</A>
</I>&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/socketcan-users">https://lists.berlios.de/mailman/listinfo/socketcan-users</A>
</I>

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002089.html">[Socketcan-users] Performance issues with MPC5200B and socketcan
</A></li>
	<LI>Next message: <A HREF="002093.html">[Socketcan-users] Performance issues with MPC5200B and socketcan
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2090">[ date ]</a>
              <a href="thread.html#2090">[ thread ]</a>
              <a href="subject.html#2090">[ subject ]</a>
              <a href="author.html#2090">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/socketcan-users">More information about the Socketcan-users
mailing list</a><br>
</body></html>
